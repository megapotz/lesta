# Техническое Задание: Lesta Blogger HUB (MVP)

## 1. Введение

### 1.1. Бизнес-цель MVP
Создать демонстрационную версию системы для Директора по маркетингу (CMO). Основная задача — показать возможность централизованного учета блогеров и контроля расходов на инфлюенсер-маркетинг. Система должна стать первым шагом к устранению хаоса в закупках и заложить основу для прозрачной аналитики.

### 1.2. Цель проекта
Оценить эффективность итеративной разработки ТЗ и последующей реализации с помощью AI-ассистента.

## 2. Пользователи и Роли

### 2.1. Маркетинг-менеджер
**Описание:** Основной операционный пользователь системы. Предполагается, что в системе может работать несколько менеджеров.
**Задачи:**
- Создание и ведение маркетинговых кампаний.
- Добавление и обновление информации по блогерам и контрагентам.
- Фиксация договоренностей по размещениям (стоимость, даты, модель оплаты).
- Внесение фактических результатов (метрик) после публикаций.
- Формирование и выгрузка реестров на оплату для бухгалтерии.

### 2.2. CMO (Директор по маркетингу)
**Описание:** Ключевой стейкхолдер, для которого создается MVP.
**Задачи:**
- Получение сводной информации на дэшборде о ходе кампаний.
- Анализ общих расходов и эффективности по блогерам и кампаниям.
- Принятие стратегических решений на основе полученных данных.

## 3. Пользовательские Истории (User Stories)

### 3.1. Маркетинг-менеджер

**Тема: Подготовка кампании**

1.  **Создание кампании:**
    *   **Как** Маркетинг-менеджер,
    *   **Я хочу** создавать новую кампанию (указав название, продукт, цель, бюджет),
    *   **Чтобы** сгруппировать все связанные размещения и отслеживать общий прогресс и расходы.

2.  **Пополнение базы блогеров:**
    *   **Как** Маркетинг-менеджер,
    *   **Я хочу** добавлять в общую базу данных новых блогеров с их ключевыми метриками (канал, подписчики, охваты),
    *   **Чтобы** формировать пул потенциальных партнеров для будущих кампаний.

3.  **Формирование списка для кампании:**
    *   **Как** Маркетинг-менеджер,
    *   **Я хочу** добавлять в конкретную кампанию как существующих, так и новых блогеров,
    *   **Чтобы** сформировать список участников для дальнейших переговоров.

**Тема: Переговоры и согласование**

4.  **Фиксация итогов переговоров:**
    *   **Как** Маркетинг-менеджер,
    *   **Я хочу** изменять статус размещения на `Согласовано` (указав финальную стоимость и дату) или `Отклонено`,
    *   **Чтобы** четко отделить тех, кто в работе, от тех, кто отказался.

5.  **Подготовка реестра на оплату:**
    *   **Как** Маркетинг-менеджер,
    *   **Я хочу** выгружать в `.xlsx` файл список всех размещений, требующих предоплаты,
    *   **Чтобы** передать в бухгалтерию единый реестр на оплату.

**Тема: Контроль и отчетность**

6.  **Контроль сроков публикаций:**
    *   **Как** Маркетинг-менеджер,
    *   **Я хочу**, чтобы система визуально (например, красным цветом) подсвечивала размещения, у которых прошла дата публикации, но статус еще не обновлен,
    *   **Чтобы** я не забывал проверить факт выхода публикации.

7.  **Внесение результатов:**
    *   **Как** Маркетинг-менеджер,
    *   **Я хочу** вносить фактические метрики (просмотры, лайки) для размещений, переведенных в статус `Опубликовано`,
    *   **Чтобы** накопить данные для последующего анализа эффективности.

**Тема: Обработка оплат**

8.  **Импорт статусов оплат:**
    *   **Как** Маркетинг-менеджер,
    *   **Я хочу** загружать в систему реестр оплат (в формате `.xlsx`), полученный от бухгалтерии,
    *   **Чтобы** автоматически обновить статусы соответствующих "Размещений" с `Ожидает оплаты` на `Оплачено, ждем публикацию`.

### 3.2. CMO (Директор по маркетингу)

**Тема: Стратегический контроль**

1.  **Обзор эффективности:**
    *   **Как** CMO,
    *   **Я хочу** на одном экране (Дэшборде) видеть ключевые метрики (общий расход, CPV, кол-во публикаций) за выбранный период,
    *   **Чтобы** быстро оценивать общую эффективность инфлюенсер-маркетинга.

2.  **Анализ партнеров:**
    *   **Как** CMO,
    *   **Я хочу** видеть топ-10 блогеров по расходам и эффективности (CPV),
    *   **Чтобы** понимать, кто из партнеров приносит наибольшую ценность.

3.  **Контроль стратегического сдвига:**
    *   **Как** CMO,
    *   **Я хочу** видеть распределение расходов по типам партнеров (прямые, агентства, сети),
    *   **Чтобы** контролировать прогресс перехода на прямую работу с блогерами.

## 4. Область действия MVP (Scope)

### 4.1. Что входит в MVP (In Scope)
- **Централизованный учет:** Создание и ведение единой базы кампаний, блогеров, контрагентов и размещений.
- **Ручной ввод данных:** Все метрики (как плановые, так и фактические) вносятся пользователем (Маркетинг-менеджером) вручную.
- **Базовый жизненный цикл:** Отслеживание размещений по ключевым статусам от "Планируется" до "Завершено".
- **Отчетность для бухгалтерии:** Возможность выгрузки реестра на оплату в формате `.xlsx`.
- **Аналитический дэшборд:** Отображение ключевых сводных метрик и отчетов для CMO.
- **Роли пользователей:** Система рассчитана на внутренних пользователей в ролях `Маркетинг-менеджер` и `CMO`.

### 4.2. Что НЕ входит в MVP (Out of Scope)
- **Автоматизация и Интеграции:**
    - Интеграция с **Alanbase** для автоматического получения ROI и LTV.
    - Интеграция с **ОРД** для получения рекламных токенов (`erid`).
    - **Парсинг** соцсетей для автоматического сбора статистики по публикациям (просмотры, лайки).
- **Финансовые операции:**
    - Проведение **прямых выплат** самозанятым через платформу.
    - Формирование и обработка **закрывающих документов**.
- **Пользователи и Роли:**
    - **Личные кабинеты** для внешних пользователей (блогеров, контрагентов).
    - Отдельная роль **"Админа"** для управления пользователями.
    - **Гранулярные права доступа** (например, чтобы менеджер видел только "свои" кампании).
- **Дополнительный функционал:**
    - **AI-ассистент** для ведения переговоров.
    - Регистрация блогеров через **чат-бота** и хранение истории переписки.
    - Автоматические **системные уведомления**.

## 5. Модель Данных и Сущности

### 5.1. Сущность "Кампания"
**Описание:** Кампания является контейнером верхнего уровня для группировки связанных размещений.
**Поля:**
- `ID` (числовое, автоинкремент, первичный ключ)
- `Название` (текстовое, обязательное)
- `Продукт` (текстовое, из справочника)
- `Цель` (длинный текст)
- `Тип` (текстовое, из справочника)
- `Бюджет` (числовое)
- `Статус` (текстовое, из справочника)
- `Дата начала` (дата)
- `Дата окончания` (дата)
- `ID Ответственного менеджера` (внешний ключ)
- `ID Менеджера-создателя` (внешний ключ, неизменяемое)
- `alanbase_sub2` (текст, уникальный, необязательное) - *Задел для будущей интеграции с Alanbase.*

### 5.2. Сущность "Контрагент"
**Описание:** Юридическое или физическое лицо, с которым ведутся финансовые расчеты. В зависимости от типа, набор полей меняется. История взаимодействий ведется через сущность "Комментарий".

**Поля:**

*   **Общие поля (для всех типов):**
    *   `ID` (числовое, автоинкремент, первичный ключ)
    *   `Название / ФИО` (текстовое, обязательное)
    *   `Тип` (текстовое, из справочника: `Самозанятый`, `ИП`, `Юридическое лицо`)
    *   `Тип отношений` (текстовое, из справочника: `Прямой`, `Агентство`, `CPA-сеть`)
    *   `Контактное лицо` (текстовое)
    *   `Email` (текстовое)
    *   `Телефон` (текстовое)
    *   `ID Менеджера-создателя` (внешний ключ, неизменяемое)

*   **Поля для типа "Юридическое лицо":**
    *   `ИНН` (10 цифр)
    *   `КПП` (9 цифр)
    *   `ОГРН` (числовое)
    *   `Юридический адрес` (текстовое)
    *   `Расчетный счет` (числовое)
    *   `Наименование банка` (текстовое)
    *   `БИК` (числовое)
    *   `Корреспондентский счет` (числовое)

*   **Поля для типа "ИП" (Индивидуальный предприниматель):**
    *   `ИНН` (12 цифр)
    *   `ОГРНИП` (числовое)
    *   `Адрес регистрации` (текстовое)
    *   `Расчетный счет` (числовое)
    *   `Наименование банка` (текстовое)
    *   `БИК` (числовое)
    *   `Корреспондентский счет` (числовое)

*   **Поля для типа "Самозанятый":**
    *   `ИНН` (12 цифр)
    *   `Телефон` (для чеков из "Мой Налог")

### 5.3. Сущность "Блогер"
**Описание:** Медийный ресурс (канал, паблик), характеризуемый аудиторными метриками.
**Поля:**
- `ID` (числовое, автоинкремент, первичный ключ)
- `Название` (текстовое, обязательное)
- `Ссылка на канал/профиль` (текст, уникальный)
- `Соцсеть` (текстовое, из справочника)
- `Подписчики` (числовое)
- `Средний охват` (числовое)
- `Тип основного контакта` (текстовое, из справочника: `Email`, `Telegram`, `WhatsApp`, `Телефон`)
- `Основной контакт` (текстовое)
- `ID Менеджера-создателя` (внешний ключ, неизменяемое)
- `alanbase_sub3` (текст, уникальный, необязательное) - *Задел для будущей интеграции с Alanbase.*

### 5.4. Сущность "Размещение"
**Описание:** Ключевая единица учета; конкретная публикация или иная активность у блогера.
**Поля:**
- `ID` (числовое, автоинкремент, первичный ключ)
- `ID Кампании` (внешний ключ)
- `ID Блогера` (внешний ключ)
- `ID Контрагента` (внешний ключ)
- `ID Менеджера-создателя` (внешний ключ, неизменяемое)
- `Placement Date` (дата)
- `Fee` (числовое)
- `Ссылка на публикацию` (текст)
- `Ссылка на скриншот` (текст)
- `Views` (числовое)
- `Likes` (числовое)
- `Comments` (числовое)
- `Shares` (числовое)
- `ER` (числовое)
- `Статус` (текстовое, из справочника)
- `Условия оплаты` (текстовое, из справочника)
- `Тип размещения` (текстовое, из справочника)
- `Модель оплаты` (текстовое, из справочника)
- `erid_token` (текстовое, необязательное) - *Задел для будущей интеграции с ОРД.*
- `alanbase_sub1` (текст, уникальный, необязательное) - *Задел для будущей интеграции с Alanbase.*
- `tracking_link` (текст, необязательное) - *Задел для будущей интеграции с Alanbase.*

### 5.5. Жизненный цикл "Размещения"
"Размещение" является ключевой сущностью, отражающей динамику работы с блогером. Для отслеживания этого процесса вводится поле **"Статус"**.

#### 5.5.1. Статусы Размещения:
- **`Планируется`**: Начальный статус. Менеджер добавил размещение в кампанию, ведет переговоры.
- **`Согласовано`**: Блогер подтвердил участие.
- **`Отклонено`**: Блогер отказался от участия.
- **`Ожидает оплаты`**: Размещение требует предоплаты и готово для передачи в бухгалтерию.
- **`Оплачено, ждем публикацию`**: Предоплата совершена, ожидается дата публикации.
- **`Опубликовано`**: Публикация размещена.
- **`Просрочено`**: Дата публикации прошла, но статус не был изменен на "Опубликовано".
- **`Завершено`**: Все метрики внесены, работа по размещению полностью завершена.

#### 5.5.2. Условия оплаты:
В карточку "Размещения" необходимо добавить поле **"Условия оплаты"** с вариантами:
- Предоплата
- Постоплата
- Частичная оплата

#### 5.5.3. Сводная таблица жизненного цикла
| Статус | Описание | Правила и ограничения | Системные действия и UI |
| :--- | :--- | :--- | :--- |
| **`Планируется`** | Начальный статус, ведутся переговоры. | - Можно редактировать все поля.<br>- Можно удалить "Размещение". | - |
| **`Согласовано`** | Участие подтверждено. | - Поля `Fee` и `Placement Date` становятся обязательными.<br>- Удаление запрещено. | - |
| **`Отклонено`** | Блогер отказался. | - Редактирование блокируется. | - Размещение скрывается из основного рабочего списка, но остается в системе для истории. |
| **`Ожидает оплаты`** | Требуется предоплата. | - Поле `Fee` блокируется для редактирования. | - Размещение попадает в выгрузку для бухгалтерии. |
| **`Оплачено, ждем публикацию`** | Предоплата совершена. | - Редактирование основных полей заблокировано. | - Если `Placement Date` прошла, а статус не изменился, строка подсвечивается в интерфейсе (см. 6.2.2). |
| **`Опубликовано`** | Публикация вышла. | - Поля для фактических метрик (`Views`, `Likes` и т.д.) становятся доступными для редактирования. | - |
| **`Просрочено`** | Автоматический статус: `Placement Date` прошла, но статус не `Опубликовано`. | - | - Строка визуально выделяется в интерфейсе (см. 6.2.2). |
| **`Завершено`** | Все метрики внесены, постоплата (если была) произведена. | - Редактирование блокируется. | - |

### 5.6. Справочники (Выпадающие списки)
Для обеспечения консистентности данных, следующие поля должны быть реализованы в виде выпадающих списков с предопределенными значениями. В рамках MVP эти значения зашиты в коде (хардкод) и не могут быть изменены пользователем через интерфейс.

#### 5.6.1. Type of placement (Тип размещения)
Отвечает на вопрос: "Что именно мы покупаем у блогера?".
- `Пост` (в Telegram, VK, Дзен)
- `Видео` (полноценное видео на YouTube, VK)
- `Shorts / Reels` (короткое вертикальное видео)
- `Стриминг` (спонсорская трансляция на Twitch, YouTube)
- `Сторис` (серия в Instagram, VK)
- `Интеграция в контент`
- `Анонс`

#### 5.6.2. Pricing Model (Модель оплаты)
Отвечает на вопрос: "Как мы платим за это размещение?".
- `Fix` (Фиксированная плата): Оплата за факт публикации.
- `CPA` (Cost Per Action): Оплата за целевое действие (например, регистрацию).
- `RevShare` (Revenue Share): Процент от дохода, который принесли привлеченные игроки.
- `Бартер`: Оплата продукцией или внутриигровыми ценностями.

### 5.7. Связи между сущностями
- **Блогер и Контрагент:** Реализуется связь "многие-ко-многим". Один блогер может быть связан с несколькими контрагентами, и один контрагент может работать с несколькими блогерами.

### 5.8. Сущность "Комментарий" (Лента Истории)
**Описание:** Запись в истории взаимодействий, привязанная к Блогеру или Контрагенту. Представляет собой единицу в "ленте" или "чате" по сущности.
**Поля:**
- `ID` (числовое, автоинкремент, первичный ключ)
- `ID Пользователя` (внешний ключ, автор комментария)
- `Дата создания` (timestamp)
- `Текст` (длинный текст)
- `ID Блогера` (внешний ключ, необязательное)
- `ID Контрагента` (внешний ключ, необязательное)

### 5.9. Сущность "Пресет цены"
**Описание:** Стандартное условие работы (услуга) с фиксированной ценой, предлагаемое блогером. Используется для быстрого доступа к прайс-листу блогера.
**Поля:**
- `ID` (числовое, автоинкремент, первичный ключ)
- `ID Блогера` (внешний ключ)
- `Название` (текстовое, обязательное, например, "Пост в Telegram")
- `Описание` (длинный текст, например, "24 часа в топе, 48 часов в ленте")
- `Стоимость` (числовое, обязательное)

## 6. Функциональные Требования

### 6.1. Валидация и целостность данных
- **Уникальность блогера:** Уникальность блогера в системе определяется полем "Ссылка на канал/профиль". При добавлении нового блогера система должна проверять, не существует ли уже запись с такой ссылкой, и выводить ошибку в случае дублирования.
- **Обновление метрик блогера:** Все метрики в профиле блогера (`Количество подписчиков`, `Средний охват поста` и т.д.) в MVP обновляются вручную менеджером.
- **Отслеживание CPA/RevShare:** В рамках MVP система не будет автоматически отслеживать эффективность `CPA` и `RevShare`. Поле `Fee` для этих моделей будет заполняться менеджером вручную на основе данных из внешних систем аналитики.
- **Комментарий должен быть привязан** либо к Блогеру, либо к Контрагенту (одно из полей `ID Блогера` или `ID Контрагента` должно быть заполнено).

### 6.2. Бизнес-логика и автоматизация
#### 6.2.1. Логика отображения данных
- **Агрегация ленты контрагента:** При просмотре страницы Контрагента, в его ленту истории должны попадать как комментарии, привязанные напрямую к нему, так и комментарии, привязанные ко всем Блогерам, которые с ним связаны.

#### 6.2.2. Визуальные индикаторы статусов
- **Подсветка просроченных размещений:** В таблицах размещений строки со статусом `Оплачено, ждем публикацию`, у которых `Placement Date` уже прошла, должны визуально выделяться (например, вся строка получает бледно-красный фон). Это должно сигнализировать менеджеру о необходимости проверить факт публикации.
- **Подсветка статуса "Просрочено":** Размещения со статусом `Просрочено` должны быть визуально выделены в общем списке.

#### 6.2.3. Логика действий пользователя
- **Удаление "Размещения":** Действие "Удалить" доступно **только** для размещений в статусе `Планируется`. Во всех остальных статусах удаление запрещено для сохранения истории.
- **Деактивация контрагента:** Реализуется логика "мягкого удаления".
    - Если с контрагентом не связано ни одного "Размещения", его можно полностью удалить из системы.
    - Если есть связанные размещения, его можно только "Деактивировать".
    - Деактивированный контрагент не отображается в выпадающих списках при создании/редактировании новых размещений, но сохраняется во всех исторических записях для целостности данных.

### 6.3. Экспорт данных
- **Экспорт для бухгалтерии:**
    - В системе должна быть возможность отфильтровать все размещения со статусом **`Ожидает оплаты`**.
    - Должна быть реализована функция **экспорта** этого отфильтрованного списка в формат `.xlsx` или `.csv`.
    - Выгрузка должна содержать минимально необходимую для оплаты информацию: Название контрагента, ИНН, сумма, название кампании.

### 6.4. Импорт данных
- В системе должна быть функция импорта `.xlsx` файла для обновления статусов размещений.
- Система должна ожидать файл определенной структуры, как минимум с колонкой `ID Размещения`.
- После загрузки файла система должна найти все "Размещения" по их `ID` и изменить их `Статус` с `Ожидает оплаты` на `Оплачено, ждем публикацию`.
- Система должна выводить краткий отчет о результатах импорта (например, "Обновлено: 15, Не найдено: 2").

### 6.5. Логирование Действий (Audit Trail)
Для обеспечения полной прозрачности и отслеживания истории изменений, все ключевые события в системе должны логироваться. Это реализуется через автоматическое создание записей в сущности "Комментарий".

**Логируемые события:**
- **Создание любой сущности:** При создании Кампании, Блогера, Контрагента или Размещения, в ленту соответствующей сущности добавляется системный комментарий: `Сущность создана менеджером [Имя менеджера]`.
- **Изменение статуса "Размещения":** При каждом изменении поля `Статус` у "Размещения", в его ленту истории добавляется системный комментарий: `Статус изменен с "[Старый статус]" на "[Новый статус]" менеджером [Имя менеджера]`.
- **Другие важные изменения:** Система должна быть готова к добавлению логирования других важных полей в будущем (например, изменение `Fee` или `Placement Date` после согласования).

**Реализация:**
- Такие системные комментарии должны визуально отличаться от комментариев, оставленных пользователями вручную (например, иметь другой фон или иконку).

## 7. Требования к Интерфейсу (UI/UX)

### 7.0. Общая концепция навигации и UX
Для обеспечения удобства и быстрого доступа ко всем связанным данным, предлагается следующая структура навигации:

**1. Основное меню (Боковая панель):**
Ключевые разделы системы будут вынесены в постоянное боковое меню для доступа из любой точки приложения:
- **Дэшборд:** Главный экран для CMO.
- **Кампании:** Основной рабочий раздел для менеджеров.
- **Партнеры:** Единый справочник, объединяющий **Блогеров** и **Контрагентов**. Внутри этого раздела будут две вкладки для переключения между ними.


**2. Контекстные переходы (Cross-linking):**
Система будет построена на принципах глубокой перелинковки, чтобы избежать лишних кликов и поиска.
- **Все сущности — это ссылки:** Любое упоминание сущности (название блогера, кампании, контрагента) в таблицах или на страницах будет являться кликабельной ссылкой, ведущей на страницу этой сущности.
- **Счетчики как фильтры:** Кликабельные счетчики (как "Публикации" в списке кампаний) будут вести на соответствующий экран с уже примененным фильтром. Например, клик на "15/20" в колонке "Публикации" откроет экран "Детали Кампании" с отфильтрованным списком из этих 20 размещений.
- **"Хлебные крошки" (Breadcrumbs):** На каждой странице будет отображаться путь, который прошел пользователь (например, `Партнеры > Контрагенты > ООО "Ромашка" > Блогеры`). Это поможет легко ориентироваться в иерархии.

**3. Единая карточка сущности:**
Каждая основная сущность (Блогер, Контрагент, Кампания) будет иметь свою детальную страницу ("карточку"), которая агрегирует всю связанную информацию:
- **Карточка Контрагента:** покажет его реквизиты, список связанных с ним блогеров, и **единую ленту комментариев** по нему и всем его блогерам.
- **Карточка Блогера:** покажет его метрики, список связанных контрагентов, и историю всех его размещений во всех кампаниях.

**4. Настройка отображения столбцов:**
- Рядом с каждой таблицей (например, над заголовками) должен быть элемент управления (иконка "колонки" или "шестеренка").
- По клику на этот элемент открывается выпадающий список со всеми доступными столбцами таблицы.
- Каждый столбец в списке имеет чекбокс. Пользователь может снимать и ставить галочки, чтобы скрыть или показать соответствующие столбцы.
- **Обязательные столбцы:** Некоторые ключевые столбцы, такие как `Инфлюенсер`, `Статус`, `Fee` и `Действия`, должны быть всегда видимы и не могут быть скрыты.
- **Сохранение настроек:** Выбор пользователя должен сохраняться (например, в `localStorage` браузера или в профиле пользователя), чтобы при следующем заходе на страницу таблица отображалась с уже настроенным набором столбцов.

### 7.1. Экран "Список Кампаний"
**Назначение:** Основной экран для просмотра всех кампаний и навигации.

- **Элементы управления:**
    - **Кнопка "+ Создать Кампанию"**: Открывает модальное окно/страницу для создания новой кампании.
    - **Кнопка "Импорт оплат"**: Открывает модальное окно для загрузки `.xlsx` файла.
    - **Панель фильтров:**
        - `Продукт`: выпадающий список (Танки, Корабли, Blitz).
        - `Статус`: выпадающий список (Активная, Завершенная, Черновик).
        - `Поиск по названию`: текстовое поле.

- **Таблица "Список Кампаний":**
    - **Колонки:**
        - `Название` (кликабельно, ведет на экран "Детали Кампании")
        - `Статус`
        - `Ответственный` (ФИО менеджера)
        - `Продукт`
        - `Даты` (Дата начала - Дата окончания)
        - `Публикации` (счетчик, факт/план, напр. "15/20"). **Счетчик является кликабельным**: клик по нему ведет на экран "Детали Кампании" с фильтром по всем размещениям данной кампании.
        - `Расход` (факт/план, напр. "80 000 / 100 000 ₽")
        - `ID` (может быть скрыт по умолчанию)
    - **Действия в строке:**
        - `Редактировать` (иконка)

### 7.1.1. Экран "Детали Кампании"
Это ключевой рабочий экран менеджера. Таблица размещений должна быть максимально информативной и функциональной.

**Элементы управления:**
- **Кнопка "Экспорт для бухгалтерии":** Находится над таблицей размещений. При нажатии, система фильтрует размещения в **текущей** кампании по статусу `Ожидает оплаты` и выгружает результат в `.xlsx` файл в соответствии с требованиями раздела `6.3. Экспорт данных`.

**Таблица "Размещения в Кампании":**
- **Визуальные индикаторы:** Подсветка строк в таблице реализуется на основе правил, описанных в разделе `6.2.2`.
- **Состав полей:**
    - `ID`
    - `Placement Date` (Дата размещения)
    - `Инфлюенсер`
    - `Контрагент`
    - `Type of placement` (Тип)
    - `Pricing Model` (Модель оплаты)
    - `Fee` (Стоимость)
    - `Ссылка на публикацию`
    - `Views` (Просмотры)
    - `Likes` (Лайки)
    - `Actual engagement rate (ER)`: **В MVP вводится вручную.**
    - `Статус`: **Единое поле статуса**, отражающее весь жизненный цикл.
    - `Действия`
- **Фильтрация и сортировка:**
    - **Фильтры:** Должна быть панель для фильтрации списка по следующим параметрам:
        - `Инфлюенсер`
        - `Контрагент`
        - `Type of placement`
        - `Статус` (единый)
        - `Placement Date` (по диапазону дат)
    - **Сортировка:** Все колонки таблицы должны быть сортируемыми по возрастанию/убыванию при клике на их заголовок.
- **Действия с размещениями:** В колонке "Действия" отображаются иконки доступных операций (например, "Редактировать", "Удалить"). Доступность действий определяется бизнес-логикой, описанной в разделе `6.2.3`.

### 7.1.2. Окно "Создание/Редактирование Кампании"
**Назначение:** Форма для ввода и изменения данных о кампании.

- **Поля ввода:**
    - `Название кампании` (текстовое поле, обязательное)
    - `Ответственный менеджер` (выпадающий список, обязательное)
    - `Продукт` (выпадающий список, обязательное)
    - `Дата начала` (поле выбора даты, обязательное)
    - `Дата окончания` (поле выбора даты, обязательное)
    - `Цель` (многострочное текстовое поле)
    - `Тип` (выпадающий список: Awareness, Performance)
    - `Бюджет` (числовое поле)
    - `Статус` (выпадающий список, доступен при редактировании)
- **Кнопки:** "Сохранить", "Отмена".

### 7.2. Экран "Дэшборд"
**Назначение:** Дать CMO ответы на ключевые вопросы: "На что мы тратим деньги?", "Насколько это эффективно?", "Как идет переход к прямым закупкам?".

**1. Фильтры:**
- `Период` (Текущий месяц, Прошлый месяц, Квартал, Год)
- `Продукт` (Все, Танки, Корабли, Blitz)

**2. Общая картина (KPI-виджеты):**
- **Общий расход:** Сумма `Fee` по всем завершенным публикациям.
- **Всего публикаций:** Кол-во завершенных публикаций.
- **Средняя стоимость просмотра (CPV):** `Общий расход` / `Сумма всех Views`.
- **Средний ER:** Средний `Engagement Rate` по всем публикациям.

**3. Операционный контроль (что происходит сейчас):**
- **Таблица "Активные Кампании":**
  - **Колонки:** `Название Кампании`, `Продукт`, `Прогресс`.
  - **Колонка "Прогресс":**
      - Отображает единый прогресс-бар, визуально сравнивающий процент прошедшего времени кампании и процент потраченного бюджета.
      - **Визуализация:** Прогресс-бар должен иметь два слоя или индикатора: один для времени, другой для бюджета.
      - **Цветовая логика:**
          - Если `% времени` > `% бюджета` (расход отстает от времени), прогресс-бар окрашивается в **желтый** цвет.
          - Если `% бюджета` > `% времени` (расход опережает время), прогресс-бар окрашивается в **зеленый** цвет.

**4. Анализ эффективности (кто работает лучше):**
- **Таблица "Эффективность по блогерам" (Топ-10):**
  - **Колонки:** `Блогер`, `Кол-во публикаций`, `Суммарный расход`, `Суммарные просмотры`, `Средний CPV`.
  - **Сортировка:** По умолчанию по `Суммарному расходу`, но все колонки кликабельны для сортировки.

**5. Стратегический сдвиг (куда мы движемся):**
- **Расход по типам партнеров (Столбчатая диаграмма):** Сравнение суммарных расходов по типам контрагентов.

### 7.3. Экран "Список Блогеров"
**Назначение:** Предоставить единый реестр всех блогеров в системе с возможностью поиска, фильтрации и быстрого доступа к их ключевым метрикам. Этот экран является частью раздела "Партнеры".

**Элементы управления:**
- **Кнопка "+ Добавить Блогера"**: Открывает форму для создания нового блогера.
- **Панель фильтров:**
    - `Поиск по названию`: текстовое поле.
    - `Соцсеть`: выпадающий список.
    - `Контрагент`: выпадающий список.

**Таблица "Список Блогеров":**
- **Колонки:**
    - `Никнейм` (кликабельно, ведет на карточку блогера)
    - `Ссылка на блог` (внешняя ссылка)
    - `Соцсеть`
    - `Количество подписчиков`
    - `Охват (средний)`
    - `ER (%)`
    - `Контрагент` (кликабельно, ведет на карточку контрагента)
- **Сортировка:** Все колонки таблицы должны быть сортируемыми.
- **Действия в строке:**
    - `Редактировать` (иконка)
    - `Посмотреть историю` (ведет на ленту комментариев по блогеру)

### 7.3.1. Окно "Создание/Редактирование Блогера"
**Назначение:** Форма для добавления нового блогера в систему и редактирования его профиля.

**Контекст:**
- Форма создания открывается по кнопке "+ Добавить Блогера" на экране "Список Блогеров" (`7.3`).
- Форма редактирования открывается по кнопке "Редактировать" в строке таблицы блогеров.

**Поля ввода:**
- `Название` (текстовое поле, обязательное)
- `Ссылка на канал/профиль` (текстовое поле, обязательное, уникальное)
- `Соцсеть` (выпадающий список, обязательное)
- `Подписчики` (числовое поле)
- `Средний охват` (числовое поле)
- `Тип основного контакта` (выпадающий список)
- `Основной контакт` (текстовое поле)
- `Контрагент` (необязательный выпадающий список с поиском для привязки к существующему контрагенту)

- **Кнопки:** "Сохранить", "Отмена".

### 7.3.2. Экран "Карточка Блогера"
**Назначение:** Агрегировать всю доступную информацию о блогере в одном месте, включая его личные данные, прайс-лист, историю размещений и взаимодействий.

**Структура экрана:**

**1. Шапка:**
- `Название` блогера
- Иконка `Соцсети` и кликабельная `Ссылка на канал/профиль`
- Кнопки действий: "Редактировать" (ведет на экран `7.3.1`), "Добавить размещение" (ведет на экран `7.5` с уже выбранным блогером).

**2. Блок ключевых метрик:**
- **Подписчики:** `[Число]`
- **Средний охват:** `[Число]`
- **Всего размещений:** `[Число]` (общее количество завершенных размещений)
- **Общие расходы:** `[Сумма]` (сумма `Fee` по всем завершенным размещениям)

**3. Основной блок с вкладками:**

*   **Вкладка "Профиль":**
    *   **Контакты:**
        *   Тип основного контакта: `[Тип]`
        *   Основной контакт: `[Значение]` (значение является кликабельной ссылкой, если тип `Email` или `Telegram`)
    *   **Связанные контрагенты:**
        *   Список контрагентов, с которыми связан блогер. Названия контрагентов кликабельны и ведут на их карточки.

*   **Вкладка "Прайс-лист":**
    *   **Таблица "Пресеты цен":**
        *   **Колонки:** `Название`, `Описание`, `Стоимость`.
        *   **Действия:** Возможность добавлять, редактировать и удалять пресеты.

*   **Вкладка "Размещения":**
    *   Таблица со всеми размещениями этого блогера. Колонки аналогичны таблице на экране "Детали Кампании" (`7.1.1`), но с добавлением колонки `Кампания`.

*   **Вкладка "Лента":**
    *   Единая лента истории, содержащая комментарии менеджеров и системные уведомления (создание, изменение статусов), связанные с этим блогером.

### 7.4. Экран "Список Контрагентов"
**Назначение:** Предоставить единый реестр всех контрагентов с возможностью поиска, фильтрации и быстрого доступа к их данным. Этот экран является частью раздела "Партнеры".

**Элементы управления:**
- **Кнопка "+ Добавить Контрагента"**: Открывает форму для создания нового контрагента.
- **Панель фильтров:**
    - `Поиск по названию/ИНН`: текстовое поле.
    - `Тип`: выпадающий список (`Самозанятый`, `ИП`, `Юридическое лицо`).
    - `Тип отношений`: выпадающий список (`Прямой`, `Агентство`, `CPA-сеть`).

**Таблица "Список Контрагентов":**
- **Колонки:**
    - `Название / ФИО` (кликабельно, ведет на карточку контрагента)
    - `Тип`
    - `ИНН`
    - `Тип отношений`
    - `Кол-во блогеров` (кликабельно, ведет на список блогеров этого контрагента)
    - `Сумма выплат`
- **Сортировка:** Все колонки таблицы должны быть сортируемыми.
- **Действия в строке:**
    - `Редактировать` (иконка)
    - `Посмотреть историю` (ведет на ленту комментариев по контрагенту)

### 7.4.1. Окно "Создание/Редактирование Контрагента"
**Назначение:** Форма для добавления нового контрагента в систему и редактирования его данных.

**Контекст:**
- Форма создания открывается по кнопке "+ Добавить Контрагента" на экране "Список Контрагентов" (`7.4`).
- Форма редактирования открывается по кнопке "Редактировать" в строке таблицы контрагентов.

**Поля ввода:**

*   **Общие поля:**
    *   `Название / ФИО` (текстовое поле, обязательное)
    *   `Тип` (выпадающий список, обязательное: `Самозанятый`, `ИП`, `Юридическое лицо`). **Выбор в этом поле динамически отображает/скрывает последующие блоки полей.**
    *   `Тип отношений` (выпадающий список)
    *   `Контактное лицо` (текстовое поле)
    *   `Email` (текстовое поле)
    *   `Телефон` (текстовое поле)

*   **Блок для "Юридическое лицо":**
    *   `ИНН`, `КПП`, `ОГРН`, `Юридический адрес` и банковские реквизиты.

*   **Блок для "ИП":**
    *   `ИНН`, `ОГРНИП`, `Адрес регистрации` и банковские реквизиты.

*   **Блок для "Самозанятый":**
    *   `ИНН`, `Телефон` (для чеков из "Мой Налог").

- **Кнопки:** "Сохранить", "Отмена".

### 7.4.2. Экран "Карточка Контрагента"
**Назначение:** Агрегировать всю доступную информацию о контрагенте в одном месте, включая его реквизиты, связанных блогеров, историю размещений и взаимодействий.

**Структура экрана:**

**1. Шапка:**
- `Название / ФИО` контрагента
- `Тип` контрагента (например, "Юридическое лицо", "ИП")
- Кнопки действий: "Редактировать" (ведет на экран `7.4.1`).

**2. Основной блок с вкладками:**

*   **Вкладка "Реквизиты":**
    *   Отображение всех полей из модели данных по контрагенту, включая контактные данные, юридическую информацию и банковские реквизиты в зависимости от типа.

*   **Вкладка "Блогеры":**
    *   Таблица со списком всех блогеров, связанных с данным контрагентом.
    *   **Колонки:** `Название`, `Соцсеть`, `Подписчики`, `Средний охват`.
    *   Название блогера является ссылкой на его карточку (`7.3.2`).

*   **Вкладка "Размещения":**
    *   Таблица со всеми размещениями, которые проходили через этого контрагента.
    *   Колонки аналогичны таблице на экране "Детали Кампании" (`7.1.1`), но с добавлением колонки `Кампания` и `Блогер`.

*   **Вкладка "Лента":**
    *   Единая лента истории, содержащая комментарии менеджеров и системные уведомления, связанные с этим контрагентом **и всеми его блогерами**, в соответствии с логикой из раздела `6.2.1`.

### 7.5. Окно "Создание/Редактирование Размещения"
**Назначение:** Форма для добавления нового размещения в рамках **текущей** кампании, а также для редактирования существующих.

**Контекст:**
- Форма создания открывается по кнопке "+ Добавить размещение" на экране "Детали Кампании" (`7.1.1`). Поле `ID Кампании` для нового размещения заполняется автоматически.
- Форма редактирования открывается по кнопке "Редактировать" в строке размещения.

**Поля ввода:**
- `Блогер` (выпадающий список с поиском, обязательное)
- `Контрагент` (выпадающий список, обязательное). Список автоматически фильтруется по контрагентам, связанным с выбранным блогером. Если у блогера один контрагент, он подставляется автоматически.
- `Дата размещения` (поле выбора даты, обязательное)
- `Стоимость (Fee)` (числовое поле, обязательное)
- `Тип размещения` (выпадающий список, обязательное)
- `Модель оплаты` (выпадающий список, обязательное)
- `Условия оплаты` (выпадающий список, обязательное)
- `Статус` (выпадающий список, доступен только при редактировании)

**Кнопки:** "Сохранить", "Отмена".

### 7.6. Экран "Список всех Размещений" (глобальный)
**Назначение:** Обеспечить глобальный поиск и фильтрацию всех размещений в системе для таких сценариев, как кросс-кампанийный анализ, мониторинг статусов и быстрый поиск исторических данных.

**Элементы управления:**

*   **Панель фильтров (расширенная):**
    *   `Поиск` (по названию блогера, контрагента, кампании)
    *   `Статус` (множественный выбор)
    *   `Кампания`
    *   `Блогер`
    *   `Контрагент`
    *   `Тип размещения`
    *   `Продукт` (из кампании)
    *   `Ответственный менеджер` (из кампании)
    *   `Дата размещения` (диапазон дат)

**Таблица "Все Размещения":**

*   **Колонки:** Состав колонок аналогичен таблице размещений в кампании (`7.1.1`), но с обязательным добавлением колонки `Кампания`. Пользователь может настраивать видимость остальных колонок.
*   Все названия сущностей (Блогер, Кампания, Контрагент) являются ссылками на их карточки.

## 8. Управление Пользователями (MVP)

### 8.1. Роли пользователей и права доступа
В рамках MVP в системе определены две роли с четким разделением прав:

*   **Админ (Admin):**
    *   Имеет полный доступ ко всем функциям системы.
    *   **Ключевые права:**
        *   Просмотр "Дэшборда" (`7.2`).
        *   Управление пользователями: создание, редактирование и деактивация других пользователей (включая других админов).
        *   Полный доступ к управлению кампаниями, блогерами, контрагентами и размещениями.

*   **Менеджер (Manager):**
    *   Основная рабочая роль.
    *   **Ограничения:**
        *   **Не имеет** доступа к разделу "Управление Пользователями".
        *   **Не имеет** доступа к "Дэшборду" (`7.2`).
    *   **Права:**
        *   Полный доступ к управлению кампаниями, блогерами, контрагентами и размещениями.

### 8.2. Процесс регистрации нового пользователя
Процесс построен на основе приглашений, чтобы администратор не управлял паролями пользователей.

**Шаги:**
1.  **Создание приглашения:** Администратор заполняет форму "Создание Пользователя" (`8.4`), указывая `Имя`, `Email` и `Роль`.
2.  **Генерация ссылки:** После сохранения, система создает нового пользователя со статусом `Приглашен` и генерирует для него уникальную, одноразовую ссылку для регистрации.
3.  **Передача ссылки (MVP):** В рамках MVP система **не отправляет** email. Она отображает сгенерированную ссылку администратору. Администратор должен скопировать эту ссылку и самостоятельно передать ее новому пользователю (например, через мессенджер).
4.  **Активация и установка пароля:** Пользователь переходит по ссылке и видит форму, где ему нужно только указать и подтвердить свой новый пароль.
5.  **Завершение:** После установки пароля, статус пользователя меняется на `Активен`, и он может войти в систему, используя свой email и новый пароль.

### 8.3. Экран "Список Пользователей"
**Доступ:** Только для роли "Админ".

**Назначение:** Предоставить администратору интерфейс для просмотра, создания и управления учетными записями пользователей системы.

**Элементы управления:**
- **Кнопка "+ Создать пользователя"**: Открывает форму для создания нового пользователя (`8.4`).

**Таблица "Список Пользователей":**
- **Колонки:**
    - `Имя` (текст)
    - `Email` (текст)
    - `Роль` (выпадающий список: `Админ`, `Менеджер`)
    - `Статус` (`Активен` / `Приглашен` / `Деактивирован`)
- **Сортировка:** Все колонки таблицы должны быть сортируемыми.
- **Действия в строке:**
    - `Редактировать`: Открывает форму редактирования пользователя (`8.4`).
    - `Деактивировать` / `Активировать`: Изменяет статус пользователя.
    - `Пересоздать ссылку-приглашение` (для пользователей в статусе `Приглашен`).

### 8.4. Окно "Создание/Редактирование Пользователя"
**Доступ:** Только для роли "Админ".

**Назначение:** Форма для создания "приглашения" для нового пользователя и редактирования данных существующего.

**Поля ввода при создании:**
- `Имя` (текстовое поле, обязательное)
- `Email` (текстовое поле, обязательное, уникальное)
- `Роль` (выпадающий список: `Админ`, `Менеджер`)

**Поля ввода при редактировании:**
- `Имя`
- `Роль`
- (Поле `Email` не редактируется)

**Кнопки:** "Сохранить", "Отмена".

## 10. Архитектурные замечания на будущее
- **Интеграция с Alanbase:** Для обеспечения будущей интеграции в модель данных добавлены поля `alanbase_sub1`, `alanbase_sub2`, `alanbase_sub3` и `tracking_link`. Они будут использоваться для сквозной аналитики ROI.
- **Интеграция с ОРД:** В сущность "Размещение" добавлено поле `erid_token` для хранения рекламного токена.
- **Прямые выплаты:** В сущность "Контрагент" добавлено поле `payment_details` для хранения платежных реквизитов.

---
## Приложение А: Глоссарий

- **Кампания** — совокупность маркетинговых активностей (размещений), объединенных общей целью, сроками и бюджетом.
- **Размещение** — ключевая единица учета; конкретная публикация или иная активность у блогера в рамках кампании (например, пост, видео, стрим).
- **Контрагент (Counterparty):** Юридическое или физическое лицо, ответственное за финансовые и организационные обязательства. Может быть приглашен в систему как "Пользователь" и управлять одним или несколькими "Блогерами".
- **Блогер (Blogger):** Медийный ресурс (YouTube-канал, Telegram-канал и т.д.), характеризуемый аудиторными метриками. Является "витриной" для "Размещений".
- **ER (Engagement Rate)** — метрика вовлеченности аудитории, рассчитываемая по формуле (лайки + комментарии + репосты) / просмотры * 100%. В MVP вносится вручную.
- **Модель оплаты (Pricing Model)** — способ оплаты за размещение.
    - **Fix** — фиксированная стоимость за публикацию.
    - **CPA (Cost Per Action)** — оплата за целевое действие (например, регистрация).
    - **RevShare (Revenue Share)** — процент от дохода, который принесли привлеченные игроки.
    - **Бартер** — оплата продукцией или внутриигровыми ценностями.
